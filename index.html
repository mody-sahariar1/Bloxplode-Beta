<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Bloxplode</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@600;700;800;900&family=Rubik+Mono+One&family=Inter:wght@300;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="menu.css">
    </head>
<body>

    <div id="bg-particles" class="particles-layer">
        <div class="cube c1"></div><div class="cube c2"></div><div class="cube c3"></div>
        <div class="cube c4"></div><div class="cube c5"></div><div class="cube c6"></div>
        <div class="cube c7"></div><div class="cube c8"></div><div class="cube c9"></div>
        <div class="cube c10"></div><div class="cube c11"></div><div class="cube c12"></div>
    </div>

    <div id="stratos-splash">
        <div class="studio-container">
            <div class="diamond-icon">‚óÜ</div>
            <div class="studio-text" data-text="STRATOS">STRATOS</div>
            <div class="studio-sub">GAMES</div>
        </div>
    </div>

    <div id="game-boot-layer">
        <div class="logo-wrapper" id="master-logo">
            <img src="logo.png" alt="BLOXPLODE" class="main-logo-img">
        </div>
        <div class="loading-zone" id="loader">
            <div class="loading-label">LOADING...</div>
            <div class="progress-track"><div class="progress-fill"></div></div>
        </div>
    </div>

    <div class="bottom-ui-layer hidden" id="menu-buttons-layer">
        <div id="main-menu" class="button-stack">
            <a href="classic/index.html" class="pill-btn green-pill">
                <div class="mini-grid-icon"><div class="mg-cell">‚àû</div></div>
                <span class="pill-text">Classic</span>
            </a>
            
            <button onclick="openAdventureMap()" class="pill-btn orange-pill">
                <div class="mini-grid-icon"><div class="mg-cell">üíé</div><div class="mg-cell">‚è±Ô∏è</div></div>
                <span class="pill-text">Adventure</span>
            </button>
        </div>
    </div>

    <div id="adventure-map-screen" class="map-overlay hidden">
        <div class="adv-header">
            <div class="trophy-icon">üèÜ</div>
            <div class="adv-title-group">
                <h1>Adventure</h1>
                <p>Win the Trophy!</p>
            </div>
        </div>

        <div class="structure-container">
            <div id="level-grid-structure" class="pixel-structure"></div>
        </div>

        <div class="bottom-action-panel">
            <a href="#" id="play-current-btn" class="big-play-btn">PLAY LEVEL 1</a>
            <div class="nav-tabs">
                <button onclick="closeAdventureMap()" class="nav-tab"><span class="tab-icon">üè†</span></button>
                <div class="nav-tab active"><span class="tab-icon">üíé</span></div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // --- BOOT SEQUENCE ---
            const stratos = document.getElementById('stratos-splash');
            const bootLayer = document.getElementById('game-boot-layer');
            const masterLogo = document.getElementById('master-logo');
            const loader = document.getElementById('loader');
            const menuButtons = document.getElementById('menu-buttons-layer');
            const particles = document.getElementById('bg-particles');

            // 1. CHECK TUTORIAL STATUS FROM MEMORY
            // If 'blox_tutorial_done' is anything other than 'true', they are a new player.
            const isTutorialDone = localStorage.getItem('blox_tutorial_done') === 'true';

            // Check if we need to show intro (Session based)
            if (sessionStorage.getItem('gameStarted') === 'true') {
                // SKIP INTRO ANIMATIONS
                stratos.style.display = 'none'; 
                loader.style.display = 'none';
                
                // --- REDIRECTION LOGIC (Fast) ---
                if (!isTutorialDone) {
                    // New player? Send them straight to the game folder.
                    // The script_v4.js inside will detect they need the tutorial.
                    window.location.href = 'classic/index.html';
                    return; 
                }

                // If Veteran Player, Show Menu
                masterLogo.classList.add('move-to-header'); 
                masterLogo.style.transition = 'none';
                menuButtons.classList.remove('hidden'); 
                menuButtons.classList.add('animate-entry');
                particles.classList.add('active'); 
                setTimeout(() => masterLogo.style.transition = '', 100);

            } else {
                // PLAY FULL INTRO SEQUENCE
                sessionStorage.setItem('gameStarted', 'true');
                
                // 1. Stratos Splash
                setTimeout(() => { stratos.classList.add('fade-out'); bootLayer.classList.add('active'); }, 4000);
                
                // 2. Loading Bar Finishes
                setTimeout(() => { 
                    loader.style.opacity = '0'; 
                    setTimeout(() => loader.style.display = 'none', 200); 
                }, 8800);

                // 3. DECISION MOMENT (9 Seconds in)
                setTimeout(() => { 
                    if (!isTutorialDone) {
                        // REDIRECT: New Player -> Tutorial
                        window.location.href = 'classic/index.html';
                    } else {
                        // REVEAL: Veteran Player -> Main Menu
                        masterLogo.classList.add('move-to-header'); 
                        menuButtons.classList.remove('hidden'); 
                        menuButtons.classList.add('animate-entry'); 
                        particles.classList.add('active');
                    }
                    
                    setTimeout(() => stratos.style.display = 'none', 500);
                }, 9000);
            }

            // Build the Trophy Grid for Adventure Mode
            generateStructure();
            
            // Handle browser back button logic
            window.addEventListener('popstate', closeMapUI);
        };

        function generateStructure() {
            const container = document.getElementById('level-grid-structure');
            const playBtn = document.getElementById('play-current-btn');
            
            // 1. GET SAVE DATA
            const currentMaxLevel = parseInt(localStorage.getItem('blox_adv_progress')) || 1;

            // Update the big green button
            playBtn.innerHTML = `PLAY LEVEL ${currentMaxLevel}`;
            playBtn.href = `bloxplode adventure level ${currentMaxLevel}/index.html`;

            // 2. DEFINE THE TROPHY SHAPE (1 = Level, 0 = Empty)
            const trophyGrid = [
                [0,0,1,1,1,1,1,1,0,0], 
                [0,1,1,1,1,1,1,1,1,0], 
                [1,1,1,1,1,1,1,1,1,1], 
                [1,1,1,1,1,1,1,1,1,1], 
                [0,1,1,1,1,1,1,1,1,0], 
                [0,0,1,1,1,1,1,1,0,0], 
                [0,0,0,1,1,1,1,0,0,0], 
                [0,0,0,1,1,1,1,0,0,0], 
                [0,0,1,1,1,1,1,1,0,0], 
                [0,1,1,1,1,1,1,1,1,0], 
                [1,1,1,1,1,1,1,1,1,1], 
                [1,1,1,1,1,1,1,1,1,1], 
            ];
            
            let rowsHTML = [];
            let levelCounter = 1;

            // 3. BUILD ROWS (Loop Bottom to Top)
            for (let r = trophyGrid.length - 1; r >= 0; r--) {
                let rowHTML = '<div class="struct-row">';
                for (let c = 0; c < 10; c++) {
                    
                    if (trophyGrid[r][c] === 1) {
                        let lvl = levelCounter;
                        let classes = 'struct-block';
                        let isLocked = false;

                        if (lvl < currentMaxLevel) {
                            classes += ' blue';
                        } else if (lvl === currentMaxLevel) {
                            classes += ' gold pulse';
                        } else {
                            classes += ' locked';
                            isLocked = true;
                        }

                        if (isLocked) {
                            rowHTML += `<div class="${classes}">${lvl}</div>`;
                        } else {
                            rowHTML += `<a href="bloxplode adventure level ${lvl}/index.html" class="${classes}">${lvl}</a>`;
                        }
                        
                        levelCounter++;
                    } else {
                        rowHTML += `<div class="struct-block empty"></div>`;
                    }
                }
                rowHTML += '</div>';
                rowsHTML.unshift(rowHTML); 
            }
            container.innerHTML = rowsHTML.join('');
            
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        function openAdventureMap() {
            history.pushState({ modal: 'adventure' }, 'Adventure', '#adventure');
            document.getElementById('menu-buttons-layer').classList.add('hidden');
            document.getElementById('master-logo').classList.add('hidden');
            
            const mapScreen = document.getElementById('adventure-map-screen');
            mapScreen.classList.remove('hidden');
            setTimeout(() => { mapScreen.classList.add('active'); }, 10);
        }

        function closeAdventureMap() {
            history.back();
        }

        function closeMapUI() {
            const mapScreen = document.getElementById('adventure-map-screen');
            
            if (mapScreen.classList.contains('active')) {
                mapScreen.classList.remove('active');
                setTimeout(() => {
                    mapScreen.classList.add('hidden');
                    document.getElementById('menu-buttons-layer').classList.remove('hidden');
                    document.getElementById('master-logo').classList.remove('hidden');
                }, 300);
            }
        }
    </script>
</body>
</html>