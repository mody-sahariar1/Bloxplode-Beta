* { box-sizing: border-box; touch-action: none; user-select: none; -webkit-user-select: none; }
body { background: #1a1a2e; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; display: flex; justify-content: center; min-height: 100vh; overflow: hidden; padding-top: 20px; }
.game-column { width: 404px; display: flex; flex-direction: column; align-items: center; }
.hidden { display: none !important; }

.top-bar { width: 100%; height: 120px; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 10px; }
.bomb-anchor { position: absolute; width: 110px; height: 110px; top: 10px; transform: rotate(10deg); pointer-events: none; z-index: 10; }

.score-bomb {
    width: 100%; height: 100%;
    background: radial-gradient(circle at 35% 35%, #444, #111 85%, #000);
    border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 40px rgba(255, 140, 0, 0.6); position: relative; z-index: 2;
    animation: heat-pulse 2s infinite alternate;
}

.digital-display {
    color: #ff4d6d; font-family: 'Courier New', Courier, monospace;
    font-weight: 900; text-shadow: 0 0 10px #ff4d6d;
    transform: rotate(-10deg); width: 80px; height: 40px;
    display: flex; justify-content: center; align-items: center;
}
#score { font-size: clamp(14px, 5.5vw, 30px); white-space: nowrap; }

.bomb-nozzle { position: absolute; top: -5px; right: 28px; width: 28px; height: 16px; background: #222; border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; transform: rotate(25deg); z-index: 3; }
.fuse-string { position: absolute; top: -16px; right: 36px; width: 14px; height: 18px; border-right: 4px solid #d1d1d1; border-top: 4px solid #d1d1d1; border-radius: 0 12px 0 0; z-index: 1; }
.spark-group { position: absolute; top: -28px; right: 24px; width: 30px; height: 30px; z-index: 4; }
.spark-core { position: absolute; inset: 8px; background: #fff; border-radius: 50%; box-shadow: 0 0 10px #fff, 0 0 20px #ffeb3b; animation: flicker 0.1s infinite alternate; }
.spark-flared { position: absolute; inset: 0; background: #ff3d00; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); animation: flicker 0.15s infinite reverse; }

@keyframes heat-pulse { from { transform: scale(1); } to { transform: scale(1.05); } }
@keyframes flicker { from { transform: scale(0.8); opacity: 0.8; } to { transform: scale(1.2); opacity: 1; } }

/* 4-PART PROGRESSIVE COMPRESSION */
.floating-score { 
    position: fixed; color: #ffbf00; font-weight: 900; pointer-events: none; 
    z-index: 2000; font-size: 24px; text-shadow: 0 0 10px rgba(0,0,0,0.8);
    transform-origin: center;
}
.score-animate { animation: score-travel 1.1s cubic-bezier(0.3, 0, 0.5, 1.4) forwards; }

@keyframes score-travel {
    0% { left: var(--start-x); top: var(--start-y); transform: translateX(-50%) scale(1); opacity: 1; }
    25% { transform: translateX(-50%) scale(0.85); } 
    50% { transform: translateX(-50%) scale(0.65); } 
    75% { transform: translateX(-50%) scale(0.40); opacity: 1; } 
    100% { left: var(--end-x); top: var(--end-y); transform: translateX(-50%) scale(0); opacity: 0; } 
}

/* EVENT NAME POP-UP - Positioned lower at 75% to prevent overlap */
.event-name-pop {
    position: absolute;
    left: 50%;
    top: 75%;
    transform: translate(-50%, -50%);
    font-family: 'Kanit', sans-serif;
    font-weight: 900;
    font-style: italic;
    font-size: 42px;
    color: #fff;
    pointer-events: none;
    z-index: 1500;
    white-space: nowrap;
    animation: event-titles-low 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes event-titles-low {
    0% { transform: translate(-50%, 0%) scale(0.5); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
    80% { transform: translate(-50%, -52%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -65%) scale(0.9); opacity: 0; }
}

#grid-wrapper { background: #16213e; padding: 12px; border-radius: 12px; width: 404px; height: 404px; position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.4); margin-top: 20px; }
#grid { display: grid; grid-template-columns: repeat(8, 44px); gap: 4px; }
.cell { width: 44px; height: 44px; background: #0f3460; border-radius: 6px; position: relative; }
.cell.occupied { background: var(--block-color); box-shadow: inset -3px -3px 6px rgba(0,0,0,0.3); }

/* PLACEMENT IMPACT */
.placed-impact { animation: cell-pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5; }
@keyframes cell-pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); filter: brightness(1.4); }
    100% { transform: scale(1); }
}

.cell.ghost { background: rgba(255, 255, 255, 0.15) !important; border: 1px solid rgba(255, 255, 255, 0.3); }
.cell.ghost-clear { background: rgba(233, 69, 96, 0.5) !important; border: 1px solid #ff4d6d; animation: pulse 0.4s infinite alternate; }
.clearing { animation: fast-explosion 0.3s ease-in forwards !important; z-index: 10; background-color: var(--block-color) !important; }
@keyframes fast-explosion { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

#tray { width: 100%; margin-top: 35px; display: flex; justify-content: space-between; height: 120px; }
.tray-slot { width: 128px; height: 120px; background: rgba(255,255,255,0.03); border-radius: 15px; display: flex; justify-content: center; align-items: center; }
.piece { position: relative; pointer-events: none; }
.block { position: absolute; width: 26px; height: 26px; background: var(--block-color); border-radius: 4px; }
.piece.dragging .block { width: 44px; height: 44px; border-radius: 6px; }
.piece.dragging { position: fixed; z-index: 1000; pointer-events: none; }

.combo-burst {
    position: absolute; top: 52%; left: 50%; transform: translate(-50%, -50%);
    font-family: 'Kanit', sans-serif; font-style: italic; font-size: 55px; font-weight: 900;
    color: #fff; -webkit-text-stroke: 2px #fff;
    filter: drop-shadow(0 0 15px var(--glow-color)); z-index: 1000; pointer-events: none; white-space: nowrap;
    animation: parallel-burst 0.98s cubic-bezier(0.15, 0.85, 0.35, 1.2) forwards;
}
.combo-num {
    font-size: 88px; margin-left: 10px;
    background: linear-gradient(to bottom, #fff, var(--glow-color)) !important;
    -webkit-background-clip: text !important; -webkit-text-fill-color: transparent !important;
    vertical-align: baseline; display: inline-block; transform: translateY(8px);
}
@keyframes parallel-burst {
    0% { transform: translate(-50%, -30%) scale(0.5); opacity: 0; }
    15% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
    85% { transform: translate(-50%, -52%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -55%) scale(0.9); opacity: 0; }
}
.reinforce { 
    position: absolute; top: 38%; left: 0; right: 0; height: 54px;
    background: linear-gradient(90deg, transparent, var(--bg-color), transparent);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Rubik Mono One', sans-serif; color: #fff !important; 
    font-size: 26px !important; letter-spacing: 5px;
    text-shadow: 0 0 10px var(--glow-color), 0 0 20px var(--glow-color);
    z-index: 1001; pointer-events: none; white-space: nowrap;
    border-top: 1px solid var(--bg-color); border-bottom: 1px solid var(--bg-color);
    animation: reinforce-slide 0.85s ease-out forwards;
}
@keyframes reinforce-slide {
    0% { transform: scaleX(0); opacity: 0; }
    15% { transform: scaleX(1); opacity: 1; }
    85% { transform: scaleX(1); opacity: 1; }
    100% { transform: scaleX(1.2); opacity: 0; }
}

#restart { position: absolute; right: -50px; background: none; border: 1px solid #e94560; color: #e94560; border-radius: 50%; width: 36px; height: 36px; cursor: pointer; }
#game-over-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.92); display: flex; align-items: center; justify-content: center; z-index: 9999; }
.game-over-box { background: #16213e; padding: 40px; border-radius: 24px; border: 2px solid #e94560; }